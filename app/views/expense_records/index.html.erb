<h1>年月ごとの割勘一覧</h1>

<% if @users.any? %>
  <table>
    <tr>
      <th>年</th>
      <th>月</th>
        <th>ユーザー名</th>
        <th>収入</th>
        <th>比率 (%)</th>
        <th>合計金額</th>
        <th>負担すべき金額</th>
        <th>差額</th>
    </tr>

    <% @expense_records_by_month.each do |month, records| %>
      <% @users.each do |user| %>
        <tr>
          <td><%= month.year %></td>
          <td><%= month.month %></td>
          <td><%= user.name %></td>
          
          <% user_record = records.find { |record| record.user == user } %>
          <% if user_record.present? %>
            <td><%= user_record.income %></td>
            <td><%= "#{user_record.ratio}%" %></td>
            <td><%= user_record.total_amount %></td>
            <td><%= user_record.burden_amount %></td>
            <td><%= user_record.difference %></td>
            <td><%= link_to t('shared_book.details'), expense_record_path(user_record) %></td>
            <td><%= link_to t('shared_book.edit'), edit_expense_record_path(user_record) %></td>
            <td><%= button_to t('shared_book.destroy'), user_record, method: :delete %></td>
          <% else %>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          <% end %>
        </tr>
      <% end %>
    <% end %>
  </table>
<% else %>
  <p>No users found.</p>
<% end %>

<%= link_to 'Back', expense_records_path %>